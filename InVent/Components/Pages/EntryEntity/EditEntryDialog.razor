@using InVent.Components.Pages.Internals
@using InVent.Components.Pages.Shared
@using InVent.Data.Models
@using InVent.Extensions
@inherits BaseEntryDialog

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.body2">@this.Header</MudText>
    </TitleContent>
    <DialogContent>
        @if (this.Entry != null){

            <MudForm @ref=this.form @bind-IsValid="this.success" @bind-Errors="this.errors" @onkeyup="DetectEnter">

                <div class="field-group">
                    <MudAutocomplete T="Refinery"
                                     @bind-Value="this.Refinery"
                                     Required
                                     ToStringFunc="(e)=> RefineryToString(e)"
                                     SearchFunc="this.SearchRefineries"
                                     Label="پالایشگاه"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Refinery = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                   @*  <MudAutocomplete T="Package"
                                     @bind-Value="this.Package"
                                     Required
                                     ToStringFunc="(e)=> PackageToString(e)"
                                     SearchFunc="this.SearchPackages"
                                     Label="بسته‌بندی"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Package = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                    <MudAutocomplete T="DeliveryOrder"
                                     @bind-Value="this.DeliveryOrder"
                                     Required
                                     ToStringFunc="(e)=> DeliveryOrderToString(e)"
                                     SearchFunc="this.SearchDeliveryOrders"
                                     Label="حواله"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.DeliveryOrder = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                    <MudAutocomplete T="Product"
                                     @bind-Value="this.Product"
                                     Required
                                     ToStringFunc="(e)=> ProductToString(e)"
                                     SearchFunc="this.SearchProducts"
                                     Label="محصول"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Product = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete> *@
                </div>
                <div class="field-group">
                    <MudTextField T="string"
                                  Value="this.DeliveryOrder?.Project?.Product?.Refinery?.Name"
                                  ReadOnly
                                  Label="پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="string"
                                  Value="this.DeliveryOrder?.Project?.Package?.Name"
                                  ReadOnly
                                  Label="بسته‌بندی"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="string"
                                  Value="this.DeliveryOrder?.Project?.Product?.Name"
                                  ReadOnly
                                  Label="محصول"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.DeliveryOrder?.Project?.Number"
                                  ReadOnly
                                  Label="شماره پروژه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="field-group">
                    <MudDatePicker @bind-Date=this.Date
                                   Culture="@DateExtension.GetPersianCulture()"
                                   TitleDateFormat="dddd, dd MMMM"
                                   DateFormat="yyyy/MM/dd"
                                   ClosingDelay="500"
                                   @ref="_picker"
                                   Variant="Variant.Outlined"
                                   Label="تاریخ تخلیه"
                                   AutoClose
                                   Editable>
                        <PickerActions>
                            <MudButton Class="mr-auto align-self-start" OnClick="SetToday">امروز</MudButton>
                        </PickerActions>
                    </MudDatePicker>
                    <MudAutocomplete T="Tanker"
                                     @bind-Value="this.Tanker"
                                     Required
                                     ToStringFunc="(e)=> TankerToString(e)"
                                     SearchFunc="this.SearchTankers"
                                     Label="راننده"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Tanker = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>

                    <MudTextField T="int?"
                                  Value="this.Filled"
                                  ValueChanged="(e)=>{this.SetFilled(e);this.SetAverage();}"
                                  Immediate
                                  Required
                                  Clearable
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.Filled = null"
                                  Label="تعداد بسته"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  @bind-Value="this.Damaged"
                                  Required
                                  Clearable
                                  Immediate
                                  Format="N0"
                                  TextUpdateSuppression="false"                                  
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.Damaged = null"
                                  Label="معیوب"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="field-group">
                    <MudTextField T="int?"
                                  Value="this.RefineryFilled"
                                  ValueChanged="e=>this.SetRefineryFilled(e)"
                                  Immediate
                                  Required
                                  Clearable
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.RefineryFilled = null"
                                  Label="پر پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.RefineryEmpty"
                                  ValueChanged="e=>this.SetRefineryEmpty(e)"
                                  Required
                                  Clearable
                                  Immediate
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.RefineryEmpty = null"
                                  Label="خالی پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.RefineryNet"
                                  TextChanged="this.SetDifference"
                                  Immediate
                                  ReadOnly
                                  Required
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  Label="خالص پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="field-group">
                    <MudTextField T="int?"
                                  Value="this.WarehouseFilled"
                                  ValueChanged="e=>this.SetWarehouseFilled(e)"
                                  Immediate
                                  Required
                                  Clearable
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.WarehouseFilled = null"
                                  Label="پر انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.WarehouseEmpty"
                                  ValueChanged="e=>this.SetWarehouseEmpty(e)"
                                  Required
                                  Clearable
                                  Immediate
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  ClearIcon="@Icons.Material.Filled.Clear"
                                  OnClearButtonClick="()=>this.WarehouseEmpty = null"
                                  Label="خالی انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.WarehouseNet"
                                  TextChanged="(e)=>{this.SetDifference();this.SetAverage();}"
                                  Immediate
                                  ReadOnly
                                  Required
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  Label="خالص انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="field-group">
                    <MudTextField T="int?"
                                  Value="this.Difference"
                                  ReadOnly
                                  Format="N0"
                                  TextUpdateSuppression="false"
                                  Adornment="Adornment.End"
                                  AdornmentText="کیلوگرم"
                                  Style="background-color:limegreen"
                                  Label="اختلاف"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="Double?"
                                  ReadOnly
                                  Value="this.Average"
                                  Label="متوسط بسته"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="attachments">
                    <FileUploadComponent Title="بیجک"
                                         IsMultiple="false"
                                         Files="this.files"
                                         Attachments="this.Attachments"
                                         ExistingAttachments="this.ExistingAttachments"
                                         Required="true">
                    </FileUploadComponent>
                    <FileUploadComponent Title="قبض باسکول"
                                         IsMultiple="false"
                                         Files="this.files"
                                         Attachments="this.Attachments"
                                         ExistingAttachments="this.ExistingAttachments"
                                         Required="true">
                    </FileUploadComponent>
                    <FileUploadComponent Title="سایر"
                                         IsMultiple="true"
                                         Files="this.files"
                                         ExistingAttachments="this.ExistingAttachments"
                                         Attachments="this.Attachments">
                    </FileUploadComponent>
                </div>
            </MudForm>

        }

@* 
        @if (this.Entry != null)
        {
            <MudForm @ref=this.form @bind-IsValid="this.success" @bind-Errors="this.errors" @onkeyup="DetectEnter">
                <div class="entry-top">
                    <MudAutocomplete T="Refinery"
                                     @bind-Value="this.Entry.Refinery"
                                     Required
                                     ToStringFunc="(e)=> RefineryToString(e)"
                                     SearchFunc="this.SearchRefineries"
                                     Label="پالایشگاه"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Entry.Refinery = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                    <MudAutocomplete T="Package"
                                     @bind-Value="this.Entry.Package"
                                     Required
                                     ToStringFunc="(e)=> PackageToString(e)"
                                     SearchFunc="this.SearchPackages"
                                     Label="بسته‌بندی"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Entry.Package = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                    <MudAutocomplete T="DeliveryOrder"
                                     @bind-Value="this.Entry.DeliveryOrder"
                                     Required
                                     ToStringFunc="(e)=> DeliveryOrderToString(e)"
                                     SearchFunc="this.SearchDeliveryOrders"
                                     Label="حواله"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Entry.DeliveryOrder = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                    <MudAutocomplete T="Product"
                                     @bind-Value="this.Entry.Product"
                                     Required
                                     ToStringFunc="(e)=> ProductToString(e)"
                                     SearchFunc="this.SearchProducts"
                                     Label="محصول"
                                     Clearable
                                     ClearIcon="@Icons.Material.Filled.Clear"
                                     OnClearButtonClick="()=>this.Entry.Product = null"
                                     Variant="Variant.Outlined">
                    </MudAutocomplete>
                </div>
                <div class="entry-mid">
                <MudDatePicker @bind-Date=this.Date
                               Culture="@DateExtension.GetPersianCulture()"
                               TitleDateFormat="dddd, dd MMMM"
                               DateFormat="yyyy/MM/dd"
                               ClosingDelay="500"
                               @ref="_picker"
                               Variant="Variant.Outlined"
                               Label="تاریخ"
                               AutoClose
                               Editable>
                    <PickerActions>
                        <MudButton Class="mr-auto align-self-start" OnClick="SetToday">امروز</MudButton>
                    </PickerActions>
                </MudDatePicker>
                <MudAutocomplete T="Tanker"
                                 @bind-Value="this.Entry.Tanker"
                                 Required
                                 ToStringFunc="(e)=> TankerToString(e)"
                                 SearchFunc="this.SearchTankers"
                                 Label="راننده"
                                 Clearable
                                 ClearIcon="@Icons.Material.Filled.Clear"
                                 OnClearButtonClick="()=>this.Entry.Tanker = null"
                                 Variant="Variant.Outlined">
                </MudAutocomplete>

                <MudTextField T="int"
                              @bind-Value="this.Entry.Filled"
                              Required
                              Label="تعداد بسته"
                              Variant="Variant.Outlined">
                </MudTextField>
                <MudTextField T="int"
                              @bind-Value="this.Entry.Damaged"
                              Required
                              Label="معیوب"
                              Variant="Variant.Outlined">
                </MudTextField>
                </div>
                <div class="entry-ref">
                    <MudTextField T="int"
                                  Value="this.Entry.RefineryFilled"
                                  ValueChanged="e=>this.SetRefineryFilled(e)"
                                  Immediate
                                  Required
                                  Label="پر پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int"
                                  Value="this.Entry.RefineryEmpty"
                                  ValueChanged="e=>this.SetRefineryEmpty(e)"
                                  Immediate
                                  Required
                                  Label="خالی پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.RefineryNet"
                                  ReadOnly
                                  Required
                                  Label="خالص پالایشگاه"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="entry-war">
                    <MudTextField T="int"
                                  @bind-Value="this.Entry.WarehouseFilled"
                                  Required
                                  Label="پر انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int"
                                  @bind-Value="this.Entry.WarehouseEmpty"
                                  Immediate
                                  Required
                                  Label="خالی انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="int?"
                                  Value="this.WarehouseNet"
                                  ReadOnly
                                  Required
                                  Label="خالص انبار"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
                <div class="entry-bot">
                    <MudTextField T="int?"
                                  Value="this.Difference"
                                  Style="background-color:limegreen"
                                  ReadOnly
                                  Required
                                  Label="اختلاف"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                    <MudTextField T="Double?"
                                  Value="this.Average"
                                  ReadOnly
                                  Required
                                  Label="متوسط بسته"
                                  Variant="Variant.Outlined">
                    </MudTextField>
                </div>
            </MudForm>
        }
     *@
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="this.Cancel">انصراف</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">ویرایش</MudButton>
    </DialogActions>
</MudDialog>